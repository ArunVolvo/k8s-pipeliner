apiVersion: apps/v1beta2
kind: Deployment
metadata:
  name: example
  namespace: production
  annotations:
    namely.com/spinnaker-image-description-account: "your-registry"
    namely.com/spinnaker-image-description-imageid: "${ trigger.properties['docker_image'] }"
    namely.com/spinnaker-image-description-registry: "your.registry.land"
    namely.com/spinnaker-image-description-repository: "org/example"
    namely.com/spinnaker-image-description-tag: "${ trigger.properties['docker_tag'] }"
    namely.com/spinnaker-load-balancers: "example"
spec:
  template:
    metadata:
      labels:
        app: example
    spec:
      containers:
      - command:
        - bundle
        - exec
        - unicorn
        - -p
        - "80"
        - -c
        - ./config/unicorn.rb
        env:
        - name: ADMIN_PASSWORD
          valueFrom:
            configMapKeyRef:
              key: ADMIN_PASSWORD
              name: super-secret-password
        # this image doesn't really matter, its going to be replaced, but its not to show intent
        image: your.registry.land/org/example:latest
        imagePullPolicy: IfNotPresent
        name: example
        ports:
        - containerPort: 80
          name: http
          protocol: TCP
